---
title: 阅读笔记】JavaScript权威指南-理解闭包
tag:
- JavaScript
categories:
- JavaScript
---
理解闭包先得理解词法作用域和作用域链
**词法作用域**
函数执行依赖于变量作用域，这个作用域是在函数定义是决定的，不是在函数调用时决定的。
为了实现这种词法作用域，javascript函数对象内部不仅包含函数的代码逻辑，还必须引用当前的作用域链
**作用域链**
- javascript是基于词法作用域的语言，每一段代码（全局代码或函数）都有一个与之关联的作用域链，这个作用域链是一个对象链表。
- 在javascript最顶层的代码中，作用域链由一个全局对象组成 
- 在不包含嵌套的函数体内，作用域上有两个对象，第一个是定义函数参数和局部变量的对象,第二个是全局对象
- 在一个嵌套的函数体内，作用域链上至少有三个对象。
- 当定义一个函数时，它实际上会保存一个作用域链。
- 当调用这个函数时，它创建一个新的对象来存储它的局部变量，并将这个对象添加至它保存的作用域链上，同时创建一个新的更长的表示函数调用作用域的链
- **对于嵌套函数，每次调用外部函数时，内部函数又会重新定义一遍，因为每次调用外部函数时作用域链都是不同的。**

闭包 由函数和函数定义是的作用域链组成
所有的javascript函数都是闭包，**闭包就是函数定义时的作用域链在函数执行时依然有效。**

根据以上规则，看看下面输出什么
```
function func(){
    var count = 0;
    function cal(){
        var num= 0
        console.log('num',num++)
         console.log('count',count++ ) ;
    }
    return cal;
}
var func1 = func();    //每次调用func都会创建一个新的作用域链和新的私有变量
var func2 = func();   //func1与func2互不影响
func()();  //num 0  count 0
func()();  //num 0  count 0
func1();   //num 0  count 0
func1();   //num 0  count 1
func2();   //num 0  count 0
func2();   //num 0  count 1
```

javascript是基于词法作用域的，函数的作用域在函数定义时就决定了，如果一个函数内部有一个嵌套函数，并将这个函数返回了，那这个返回的函数韩式可以访问定义时就决定的作用域链，所以这个返回的函数在父函数外部能访问到父函数内部的变量，这样这个函数就形成了一个闭包。